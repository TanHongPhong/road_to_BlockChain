import { useState } from 'react';
import { Button } from './components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './components/ui/select';
import { Card } from './components/ui/card';
import { Badge } from './components/ui/badge';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Area, AreaChart } from 'recharts';
import { AlertCircle, TrendingUp, TrendingDown, Activity, FileText } from 'lucide-react';

// Mock data cho biểu đồ nhiệt độ
const generateTemperatureData = (timeRange: string) => {
  const now = new Date();
  const data = [];
  let points = 0;
  let interval = 0;

  switch (timeRange) {
    case '1h':
      points = 60;
      interval = 1;
      break;
    case '6h':
      points = 72;
      interval = 5;
      break;
    case '12h':
      points = 72;
      interval = 10;
      break;
    case '24h':
      points = 96;
      interval = 15;
      break;
    case '7d':
      points = 84;
      interval = 120;
      break;
  }

  for (let i = points - 1; i >= 0; i--) {
    const time = new Date(now.getTime() - i * interval * 60000);
    const temp = 22 + Math.sin(i / 10) * 5 + Math.random() * 3;
    data.push({
      time: time.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }),
      temperature: parseFloat(temp.toFixed(1)),
    });
  }

  return data;
};

// Mock data cho cảm biến
const sensors = [
  {
    id: 'SN001',
    name: 'Kho A1',
    location: 'Tầng 1',
    temperature: 24.5,
    status: 'active',
  },
  {
    id: 'SN002',
    name: 'Kho B2',
    location: 'Tầng 2',
    temperature: 26.8,
    status: 'active',
  },
  {
    id: 'SN003',
    name: 'Kho C3',
    location: 'Tầng 3',
    temperature: 23.2,
    status: 'active',
  },
  {
    id: 'SN004',
    name: 'Kho D4',
    location: 'Tầng 1',
    temperature: 25.1,
    status: 'warning',
  },
];

// Mock data cho lịch sử
const temperatureHistory = [
  {
    date: '14/10/2025 14:30',
    area: 'Kho A1',
    temperature: 24.5,
    change: '+0.8',
    trend: 'up',
  },
  {
    date: '14/10/2025 13:45',
    area: 'Kho B2',
    temperature: 26.8,
    change: '-0.3',
    trend: 'down',
  },
  {
    date: '14/10/2025 12:20',
    area: 'Kho C3',
    temperature: 23.2,
    change: '+0.5',
    trend: 'up',
  },
  {
    date: '14/10/2025 11:15',
    area: 'Kho D4',
    temperature: 25.1,
    change: '-1.2',
    trend: 'down',
  },
  {
    date: '14/10/2025 10:30',
    area: 'Kho A1',
    temperature: 23.7,
    change: '+1.5',
    trend: 'up',
  },
];

// Mock data cho cảnh báo
const alerts = [
  {
    time: '14/10/2025 14:36',
    title: 'Nhiệt độ vượt ngưỡng 40°C',
    description: 'Kho D4 đã ghi nhận nhiệt độ 41.2°C, vượt ngưỡng cho phép',
    severity: 'high',
  },
  {
    time: '14/10/2025 13:22',
    title: 'Cảnh báo nhiệt độ cao',
    description: 'Khu vực Kho B2 có xu hướng tăng nhiệt độ liên tục trong 2 giờ',
    severity: 'medium',
  },
  {
    time: '14/10/2025 11:45',
    title: 'Nhiệt độ không ổn định',
    description: 'Cảm biến SN003 ghi nhận biến động nhiệt độ bất thường',
    severity: 'medium',
  },
];

export default function App() {
  const [selectedArea, setSelectedArea] = useState('all');
  const [timeRange, setTimeRange] = useState('24h');
  const [chartData, setChartData] = useState(generateTemperatureData('24h'));

  const handleTimeRangeChange = (range: string) => {
    setTimeRange(range);
    setChartData(generateTemperatureData(range));
  };

  const currentTemp = chartData[chartData.length - 1]?.temperature || 0;
  const avgTemp = (chartData.reduce((sum, d) => sum + d.temperature, 0) / chartData.length).toFixed(1);
  const minTemp = Math.min(...chartData.map(d => d.temperature)).toFixed(1);
  const maxTemp = Math.max(...chartData.map(d => d.temperature)).toFixed(1);

  return (
    <div className="min-h-screen bg-[#F5F7FA] p-5">
      {/* Header */}
      <div className="mb-5 flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="flex items-center gap-2">
            <Activity className="h-6 w-6 text-[#3B82F6]" />
            <h1 className="text-[#030213]">Giám sát nhiệt độ</h1>
          </div>
          
          <Select value={selectedArea} onValueChange={setSelectedArea}>
            <SelectTrigger className="w-[240px] bg-white border-[#E5E7EB] rounded-lg">
              <SelectValue placeholder="Chọn khu vực" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">Tất cả khu vực</SelectItem>
              <SelectItem value="floor1">Tầng 1</SelectItem>
              <SelectItem value="floor2">Tầng 2</SelectItem>
              <SelectItem value="floor3">Tầng 3</SelectItem>
              <SelectItem value="khoA1">Kho A1</SelectItem>
              <SelectItem value="khoB2">Kho B2</SelectItem>
              <SelectItem value="khoC3">Kho C3</SelectItem>
              <SelectItem value="khoD4">Kho D4</SelectItem>
            </SelectContent>
          </Select>
        </div>

        <div className="flex items-center gap-4">
          <div className="flex items-center gap-3 px-4 py-2 bg-white rounded-lg border border-[#E5E7EB]">
            <div>
              <div className="text-xs text-[#6B7280]">Nhiệt độ hiện tại</div>
              <div className="text-[#030213]">{currentTemp}°C</div>
            </div>
            <div className="h-8 w-px bg-[#E5E7EB]"></div>
            <div>
              <div className="text-xs text-[#6B7280]">Trung bình</div>
              <div className="text-[#030213]">{avgTemp}°C</div>
            </div>
            <div className="h-8 w-px bg-[#E5E7EB]"></div>
            <div>
              <div className="text-xs text-[#6B7280]">Min/Max</div>
              <div className="text-[#030213]">{minTemp}°C / {maxTemp}°C</div>
            </div>
          </div>
          
          <Button className="bg-[#3B82F6] hover:bg-[#2563EB] text-white rounded-lg px-6">
            <FileText className="h-4 w-4 mr-2" />
            Báo cáo
          </Button>
        </div>
      </div>

      {/* Main Content */}
      <div className="grid grid-cols-[1fr_320px] gap-5">
        {/* Left Column */}
        <div className="flex flex-col gap-5">
          {/* Chart */}
          <Card className="p-4 bg-white border-[#E5E7EB] rounded-lg shadow-sm">
            <div className="mb-4">
              <h3 className="text-[#030213] mb-1">Nhiệt độ khu vực</h3>
              <div className="text-sm text-[#6B7280]">Biểu đồ nhiệt độ theo thời gian</div>
            </div>

            <div className="h-[320px]">
              <ResponsiveContainer width="100%" height="100%">
                <AreaChart data={chartData}>
                  <defs>
                    <linearGradient id="colorTemp" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="5%" stopColor="#3B82F6" stopOpacity={0.3}/>
                      <stop offset="95%" stopColor="#3B82F6" stopOpacity={0}/>
                    </linearGradient>
                  </defs>
                  <CartesianGrid strokeDasharray="3 3" stroke="#E5E7EB" />
                  <XAxis 
                    dataKey="time" 
                    stroke="#9CA3AF"
                    tick={{ fontSize: 12 }}
                    tickLine={false}
                  />
                  <YAxis 
                    stroke="#9CA3AF"
                    tick={{ fontSize: 12 }}
                    tickLine={false}
                    label={{ value: '°C', angle: -90, position: 'insideLeft', style: { fontSize: 12, fill: '#6B7280' } }}
                  />
                  <Tooltip 
                    contentStyle={{ 
                      backgroundColor: 'white', 
                      border: '1px solid #E5E7EB', 
                      borderRadius: '8px',
                      fontSize: '14px'
                    }}
                    formatter={(value: number) => [`${value}°C`, 'Nhiệt độ']}
                  />
                  <Area 
                    type="monotone" 
                    dataKey="temperature" 
                    stroke="#3B82F6" 
                    strokeWidth={2}
                    fill="url(#colorTemp)"
                  />
                </AreaChart>
              </ResponsiveContainer>
            </div>

            {/* Time Range Selector */}
            <div className="flex items-center justify-center gap-2 mt-4 pt-4 border-t border-[#E5E7EB]">
              {[
                { label: '1 giờ', value: '1h' },
                { label: '6 giờ', value: '6h' },
                { label: '12 giờ', value: '12h' },
                { label: '24 giờ', value: '24h' },
                { label: '7 ngày', value: '7d' },
              ].map((range) => (
                <button
                  key={range.value}
                  onClick={() => handleTimeRangeChange(range.value)}
                  className={`px-4 py-1.5 rounded-lg transition-colors ${
                    timeRange === range.value
                      ? 'bg-[#3B82F6] text-white'
                      : 'bg-[#F3F4F6] text-[#6B7280] hover:bg-[#E5E7EB]'
                  }`}
                >
                  {range.label}
                </button>
              ))}
            </div>
          </Card>

          {/* Temperature History */}
          <Card className="p-4 bg-white border-[#E5E7EB] rounded-lg shadow-sm">
            <h3 className="text-[#030213] mb-4">Lịch sử thay đổi nhiệt độ</h3>
            
            <div className="space-y-3">
              <div className="grid grid-cols-[160px_1fr_100px_100px] gap-4 pb-2 border-b border-[#E5E7EB] text-sm text-[#6B7280]">
                <div>Thời gian</div>
                <div>Khu vực</div>
                <div>Nhiệt độ</div>
                <div>Biến động</div>
              </div>
              
              {temperatureHistory.map((item, index) => (
                <div 
                  key={index}
                  className="grid grid-cols-[160px_1fr_100px_100px] gap-4 py-2 border-b border-[#F3F4F6] hover:bg-[#F9FAFB] -mx-4 px-4 rounded-lg transition-colors"
                >
                  <div className="text-sm text-[#6B7280]">{item.date}</div>
                  <div className="text-sm text-[#030213]">{item.area}</div>
                  <div className="text-sm text-[#030213]">{item.temperature}°C</div>
                  <div className="flex items-center gap-1">
                    {item.trend === 'up' ? (
                      <TrendingUp className="h-4 w-4 text-[#FF4D4F]" />
                    ) : (
                      <TrendingDown className="h-4 w-4 text-[#3B82F6]" />
                    )}
                    <span className={`text-sm ${item.trend === 'up' ? 'text-[#FF4D4F]' : 'text-[#3B82F6]'}`}>
                      {item.change}°C
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </Card>
        </div>

        {/* Right Column */}
        <div className="flex flex-col gap-5">
          {/* Sensors List */}
          <Card className="p-4 bg-white border-[#E5E7EB] rounded-lg shadow-sm">
            <h3 className="text-[#030213] mb-4">Danh sách cảm biến</h3>
            
            <div className="space-y-3">
              {sensors.map((sensor) => (
                <div 
                  key={sensor.id}
                  className="p-3 bg-[#F9FAFB] rounded-lg border border-[#E5E7EB] hover:border-[#3B82F6] transition-colors"
                >
                  <div className="flex items-start gap-3 mb-3">
                    <div className="p-2 bg-[#3B82F6]/10 rounded-lg">
                      <Activity className="h-5 w-5 text-[#3B82F6]" />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="text-sm text-[#030213]">{sensor.id}</span>
                        <Badge 
                          variant={sensor.status === 'active' ? 'default' : 'destructive'}
                          className={`text-xs ${
                            sensor.status === 'active' 
                              ? 'bg-[#10B981] hover:bg-[#059669]' 
                              : 'bg-[#FFA940] hover:bg-[#FF8C00]'
                          }`}
                        >
                          {sensor.status === 'active' ? 'Hoạt động' : 'Cảnh báo'}
                        </Badge>
                      </div>
                      <div className="text-xs text-[#6B7280] mb-1">{sensor.name}</div>
                      <div className="text-xs text-[#6B7280]">{sensor.location}</div>
                    </div>
                  </div>
                  
                  <div className="flex items-center justify-between mb-3">
                    <span className="text-xs text-[#6B7280]">Nhiệt độ hiện tại</span>
                    <span className="text-sm text-[#030213]">{sensor.temperature}°C</span>
                  </div>
                  
                  <Button 
                    variant="outline" 
                    className="w-full border-[#3B82F6] text-[#3B82F6] hover:bg-[#3B82F6] hover:text-white rounded-lg"
                  >
                    Xem chi tiết
                  </Button>
                </div>
              ))}
            </div>
          </Card>

          {/* Alerts */}
          <Card className="p-4 bg-white border-[#E5E7EB] rounded-lg shadow-sm">
            <h3 className="text-[#030213] mb-4">Cảnh báo nhiệt độ</h3>
            
            <div className="space-y-3">
              {alerts.map((alert, index) => (
                <div 
                  key={index}
                  className="p-3 rounded-lg border hover:shadow-md transition-shadow"
                  style={{
                    borderColor: alert.severity === 'high' ? '#FF4D4F' : '#FFA940',
                    backgroundColor: alert.severity === 'high' ? '#FFF1F0' : '#FFF7E6',
                  }}
                >
                  <div className="flex items-start gap-3">
                    <div 
                      className="p-2 rounded-lg"
                      style={{
                        backgroundColor: alert.severity === 'high' ? '#FF4D4F20' : '#FFA94020'
                      }}
                    >
                      <AlertCircle 
                        className="h-5 w-5"
                        style={{ color: alert.severity === 'high' ? '#FF4D4F' : '#FFA940' }}
                      />
                    </div>
                    <div className="flex-1">
                      <div className="text-xs text-[#6B7280] mb-1">{alert.time}</div>
                      <div className="text-sm text-[#030213] mb-1">{alert.title}</div>
                      <div className="text-xs text-[#6B7280]">{alert.description}</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </Card>
        </div>
      </div>
    </div>
  );
}
